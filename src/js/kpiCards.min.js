/**
 * kpiNumericcard.js
 *
 * @fileoverview  Apex plugin that displays KPI information in the form of Numeric Cards.
 * @link          https://github.com/planetapex/apex-plugin-kpiNumericCard/
 * @author        M.Yasir Ali Shah (https://apexfusion.blogspot.com/)
 * @version       1.0
 * @requires      jQuery 1.8+
 *
 * @license kpiNumericCards  Apex Plugin v1.0
 * https://github.com/planetapex/apex-plugin-kpiNumericCard/
 * Copyright 2017 - M.Yasir Ali Shah (https://apexfusion.blogspot.com/p/about)
 * Released under the MIT license.
 * <https://raw.github.com/planetapex/apex-plugin-kpiNumericCard/master/LICENSE.txt>
 */
 !function(e,o,t,a){t.widget("ui.kpiNumCards",{options:{cards:[{colSpan:3}],ajaxIdentifier:null,pageItems:"",templateNo:2,noDataFoundMessage:"",noData:!1},gNoData$:null,gRegion$:null,gRegionBody$:null,_create:function(){var e=this;e.gRegion$=t("#"+e.element.attr("id"),apex.gPageContext$),this._buildTemplate(),e.gRegion$.on("apexrefresh",e._refresh.bind(e)).trigger("apexrefresh")},_init:function(){},_buildTemplate:function(){var o=this;if(o.gRegion$=t("#"+o.element.attr("id"),apex.gPageContext$),o.gRegionBody$=o.gRegion$.find(".t-Region-body"),0===o.gRegionBody$.length){var a=e.htmlBuilder();a.markup('<div class="t-Region-bodyWrap"><div class="t-Region-body kpiNumContainer"></div></div>'),o.gRegionBody$=o.gRegion$.append(a.toString()).find(".t-Region-body")}else o.gRegionBody$.addClass("kpiNumContainer");var i=e.htmlBuilder();i.markup('<div class="a-kpinum-message a-kpinum-noDataFound-container">').markup('<div class="a-kpinum-messageIcon  a-kpinum-noDataFound">').markup('<span class="a-Icon icon-irr-help"></span></div>').markup('<span class="a-kpinum-messageText">#MSG#</span></div>'),o.gNoData$=t(i.toString().replace("#MSG#",o.options.noDataFoundMessage)).hide(),o.gRegionBody$.after(o.gNoData$)},_draw:function(o){var a=this;this.options.cards;t.extend(this.options,o);for(var i=this.options.cards.length,n=a.options,r=0;i>r;r++){var d,s=n.cards[r],l=(e.htmlBuilder(),a.element.attr("id")+"_kpinum_"+(r+1)),p=e.htmlBuilder();p.markup('<div class="col col-#COL_SPAN#">'),2==n.templateNo?p.markup('<div class="t-Region t-Region--scrollBody t-Region-bodyWrap" role="group" aria-labelledby="'+a.element.attr("id")+'_card_heading"><div class="t-Region-body">'):3==n.templateNo&&p.markup('<div class="t-Region t-Region--scrollBody" role="group" aria-labelledby="'+a.element.attr("id")+'_card_heading">').markup('<div class="t-Region-header"><div class="t-Region-headerItems t-Region-headerItems--title"><h2 class="t-Region-title" id="'+a.element.attr("id")+'_card_heading">#REG_TITLE#</h2></div>').markup('</div><div class="t-Region-bodyWrap"><div class="t-Region-body">'),p.markup('<div id = "'+l+'"></div>'),1==n.templateNo?p.markup("</div>"):2==n.templateNo?p.markup("</div></div>"):p.markup("</div></div></div></div>"),d=p.toString().replace("#COL_SPAN#",s.colSpan),d=3==n.templateNo?d.replace("#REG_TITLE#",s.title):d.replace("#REG_TITLE#",""),3==n.templateNo&&(s.title=""),a.gRegionBody$.append(d);t("#"+l).NumTrendKPI(s);1==n.templateNo?(t("#"+l+" .kpi-title").css("background-color",s.headerColor),t("#"+l+" .kpi-title").css({color:s.headerFontColor,"font-size":s.headerFontSize+"px"}),t("#"+l+" .num-trend-kpi-container").css("background-color",s.cardColor),t("#"+l+" .num-trend-kpi-container .kpi-data.num-trend-kpi-data .num-trend-kpi-data-text").css({color:s.cardTextColor,"font-size":s.cardTextSize+"px"}),t("#"+l+" .num-trend-kpi-container .num-trend-kpi-footer .kpi-footer-text").css({color:s.FooterTextColor,"font-size":s.FooterTextSize+"px"})):(2==n.templateNo||3==n.templateNo)&&(t("#"+l+" .kpi-title").hide(),t("#"+l).closest(".t-Region-body").css("padding","0px"),t("#"+l+" .num-trend-kpi-container").css("box-shadow","none"),t("#"+l).closest(".t-Region-bodyWrap").prev().css("background-color",s.headerColor),t("#"+l).closest(".t-Region-bodyWrap").prev().find(".t-Region-title").css({color:s.headerFontColor,"font-size":s.headerFontSize+"px"}),t("#"+l+" .num-trend-kpi-container").css("background-color",s.cardColor),t("#"+l+" .num-trend-kpi-container .kpi-data.num-trend-kpi-data .num-trend-kpi-data-text").css({color:s.cardTextColor,"font-size":s.cardTextSize+"px"}),t("#"+l+" .num-trend-kpi-container .num-trend-kpi-footer .kpi-footer-text").css({color:s.FooterTextColor,"font-size":s.FooterTextSize+"px"}))}3==n.templateNo},_debug:function(e){apex.debug.log(e)},_clear:function(){},_refresh:function(){var e,o=this;apex.server.plugin(o.options.ajaxIdentifier,{pageItems:o.options.pageItems},{dataType:"json",accept:"application/json",beforeSend:function(){e=apex.util.showSpinner(o.gRegion$)},success:function(e){e.cards.length>=1?(o.gNoData$.hide(),o.gRegionBody$.show(),o.gRegionBody$.html(""),o._draw(e)):(o.gRegionBody$.hide(),o.gNoData$.show())},complete:function(o){e.remove()},error:o._debug,clear:o._clear})},_createTag:function(e){return t(document.createElement(e))}})}(apex.util,apex.server,apex.jQuery);